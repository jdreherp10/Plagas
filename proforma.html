<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Proforma Ecuafumi</title>
    <style>
        @media print {
            .no-print { display: none; }
            body { margin: 0; }
        }
        
        body {
            font-family: Arial, sans-serif;
            max-width: 210mm;
            margin: 0 auto;
            padding: 20px;
        }
        
        .print-button {
            background: #4ab646;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        /* Resto de estilos del PDF */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #2a59a8;
            padding-bottom: 15px;
        }
        
        .logo {
            height: 80px;
        }
        
        .proforma-box {
            border: 2px solid #2a59a8;
            padding: 15px;
            border-radius: 5px;
        }
        
        /* M치s estilos... */
    </style>
</head>
<body>
    <button class="print-button no-print" onclick="window.print()">
        游닌 Descargar PDF
    </button>
    
    <div class="header">
        <img src="https://raw.githubusercontent.com/jdreherp10/Plagas/main/Logo-web-ECUAFUMI.png" class="logo">
        <div class="proforma-box">
            <h2 style="color: #4ab646;">PROFORMA N.췈 <span id="numero">2024-001</span></h2>
            <p>Fecha: <span id="fecha">27/08/2025</span></p>
        </div>
    </div>
    
    <!-- Resto del HTML de la proforma -->
    <script>
    // Funci칩n mejorada para manejar m칰ltiples plagas
    function getUrlParams() {
        const params = new URLSearchParams(window.location.search);
        
        // Intentar parsear plagas desde JSON
        let plagas = [];
        try {
            const plagasParam = params.get('plagas');
            if (plagasParam) {
                plagas = JSON.parse(decodeURIComponent(plagasParam));
            }
        } catch (e) {
            console.log('Error parseando plagas, usando valores default');
            plagas = [
                {nombre: "Servicio", lugares: "General", metodos: "Est치ndar", precio: 100}
            ];
        }
        
        return {
            numero: params.get('numero') || '2024-001',
            fecha: params.get('fecha') || new Date().toLocaleDateString('es-EC'),
            clienteNombre: params.get('cliente_nombre') || 'Cliente Demo',
            clienteRuc: params.get('cliente_ruc') || '9999999999',
            clienteAtencion: params.get('cliente_atencion') || 'Gerente General',
            clienteDireccion: params.get('cliente_direccion') || 'Direcci칩n del cliente',
            clienteTelefono: params.get('cliente_telefono') || '099-999-9999',
            clienteEmail: params.get('cliente_email') || 'cliente@email.com',
            plagas: plagas,
            proceso: params.get('proceso') || 'Proceso est치ndar de fumigaci칩n',
            observaciones: params.get('observaciones') || 'Sin observaciones adicionales',
            firmaNombre: params.get('firma_nombre') || 'Ejecutivo Comercial',
            firmaCargo: params.get('firma_cargo') || 'Ejecutivo',
            formaPago: params.get('forma_pago') || 'Contado'
        };
    }
    
    // Agregar campo de forma de pago al HTML
    function fillTemplate() {
        const data = getUrlParams();
        
        // ... resto del c칩digo igual ...
        
        // Agregar forma de pago despu칠s del total
        if (data.formaPago) {
            const totalsDiv = document.querySelector('.totals');
            totalsDiv.innerHTML += `
                <div class="total-row" style="margin-top: 15px; padding-top: 10px; border-top: 1px solid #ddd;">
                    <span><strong>Forma de Pago:</strong></span>
                    <span>${data.formaPago}</span>
                </div>
            `;
        }
    }
    
    fillTemplate();
</script>
</body>
</html>
